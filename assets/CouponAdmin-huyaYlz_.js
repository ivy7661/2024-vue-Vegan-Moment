import{m as g}from"./modalMixin-0ksQEDZU.js";import{_ as h,o as i,c,b as e,t as p,g as u,u as r,z as x,d as f,r as C,F as $,f as y,h as v}from"./index-A52Ioxsw.js";const k={props:["coupon","isNew"],data(){return{modal:"",editCoupon:{},due_date:""}},mixins:[g],watch:{coupon(){this.editCoupon=this.coupon;const t=new Date(this.editCoupon.due_date*1e3).toISOString().split("T");[this.due_date]=t},due_date(){this.editCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}}},D={class:"modal fade",ref:"modal",tabindex:"-1"},V={class:"modal-dialog modal-dialog-centered"},N={class:"modal-content"},T={class:"modal-header bg-dark"},U={class:"modal-title text-white",id:"exampleModalLabel"},A=e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal"},null,-1),I={class:"modal-body"},E={class:"mb-3"},L=e("label",{for:"code",class:"form-label"},"優惠券名稱",-1),P={class:"mb-3"},S=e("label",{for:"code",class:"form-label"},"優惠碼",-1),R={class:"mb-3"},B=e("label",{for:"percent",class:"form-label"},"折扣百分比",-1),H={class:"mb-3"},O=e("label",{for:"date",class:"form-label"},"使用期限",-1),F={class:"mb-3 form-check"},j=e("label",{for:"is_enabled",class:"form-check-label"},"是否啟用",-1),z={class:"modal-footer"},W=e("button",{type:"button",class:"btn btn-outline-dark","data-bs-dismiss":"modal"},"取消",-1);function q(t,o,d,b,s,a){return i(),c("div",D,[e("div",V,[e("div",N,[e("div",T,[e("h5",U,p(d.isNew?"新增":"編輯")+"優惠券 ",1),A]),e("div",I,[e("form",null,[e("div",E,[L,u(e("input",{type:"text",class:"form-control",id:"code","onUpdate:modelValue":o[0]||(o[0]=n=>s.editCoupon.title=n),placeholder:"請輸入優惠券名稱"},null,512),[[r,s.editCoupon.title]])]),e("div",P,[S,u(e("input",{type:"text",class:"form-control",id:"code","onUpdate:modelValue":o[1]||(o[1]=n=>s.editCoupon.code=n),placeholder:"請輸入優惠碼"},null,512),[[r,s.editCoupon.code]])]),e("div",R,[B,u(e("input",{type:"number",min:"1",max:"100",class:"form-control",id:"percent","onUpdate:modelValue":o[2]||(o[2]=n=>s.editCoupon.percent=n),placeholder:"請輸入折扣百分比（數字）"},null,512),[[r,s.editCoupon.percent,void 0,{number:!0}]])]),e("div",H,[O,u(e("input",{type:"date",class:"form-control",id:"date","onUpdate:modelValue":o[3]||(o[3]=n=>s.due_date=n),placeholder:"請輸入使用期限"},null,512),[[r,s.due_date]])]),e("div",F,[u(e("input",{type:"checkbox",class:"form-check-input",id:"is_enabled","true-value":1,"false-value":0,"onUpdate:modelValue":o[4]||(o[4]=n=>s.editCoupon.is_enabled=n)},null,512),[[x,s.editCoupon.is_enabled]]),j])])]),e("div",z,[W,e("button",{type:"button",class:"btn btn-secondary",onClick:o[5]||(o[5]=n=>t.$emit("updateCoupon",t.tempCoupon))}," 確認 ")])])])],512)}const G=h(k,[["render",q]]),J={props:["coupon"],data(){return{modal:""}},mixins:[g]},K={class:"modal fade",ref:"modal",tabindex:"-1"},Q={class:"modal-dialog modal-dialog-centered"},X={class:"modal-content"},Y=e("div",{class:"modal-header bg-danger"},[e("h5",{class:"modal-title text-white",id:"exampleModalLabel"},"刪除優惠券"),e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Z={class:"modal-body"},ee={class:"text-danger"},oe={class:"modal-footer"},te=e("button",{type:"button",class:"btn btn-outline-danger","data-bs-dismiss":"modal"},"取消",-1);function se(t,o,d,b,s,a){return i(),c("div",K,[e("div",Q,[e("div",X,[Y,e("div",Z,[f(" 確認刪除優惠券 "),e("span",ee,p(d.coupon.title),1),f(" ？（刪除後將無法恢復） ")]),e("div",oe,[te,e("button",{type:"button",class:"btn btn-danger",onClick:o[0]||(o[0]=n=>t.$emit("deleteCoupon"))}," 確認刪除 ")])])])],512)}const ne=h(J,[["render",se]]);var le={VITE_API_URL:"https://ec-course-api.hexschool.io/v2",VITE_API_PATH:"js23",BASE_URL:"/HW-Vue-week6/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API_URL:_,VITE_API_PATH:m}=le,de={data(){return{coupons:[],tempCoupon:{title:"",is_enabled:0,percent:100,code:""},isNew:!0,page:{}}},components:{CouponModal:G,DelCouponModal:ne},mounted(){this.getCoupons()},methods:{getCoupons(t=1){this.$http.get(`${_}/api/${m}/admin/coupons?page=${t}`).then(o=>{this.coupons=o.data.coupons,this.page=o.data.pagination}).catch(o=>{console.log(o)})},openModal(t,o){t==="new"?(this.tempCoupon={is_enabled:0,due_date:new Date().getTime()/1e3},this.isNew=!0,this.$refs.couponModal.openModal()):t==="edit"?(this.tempCoupon={...o},this.isNew=!1,this.$refs.couponModal.openModal()):t==="delete"&&(this.tempCoupon={...o},this.$refs.delModal.openModal())},updateCoupon(){let t="post",o=`${_}/api/${m}/admin/coupon`;this.isNew||(t="put",o=`${_}/api/${m}/admin/coupon/${this.tempCoupon.id}`),this.$http[t](o,{data:this.tempCoupon}).then(d=>{this.$refs.couponModal.hideModal(),this.getCoupons()}).catch(d=>{console.log(d)})},deleteCoupon(){this.$http.delete(`${_}/api/${m}/admin/coupon/${this.tempCoupon.id}`).then(t=>{this.$refs.delModal.hideModal(),this.getCoupons()}).catch(t=>{console.log(t)})}}},ae=e("h2",{class:"mt-2"},"優惠券管理",-1),ie={class:"container mt-20"},ce={class:"text-end m-5"},pe={class:"row"},ue={class:"col-12"},re={class:"table table-hover"},_e=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"優惠券名稱"),e("th",{scope:"col"},"優惠碼"),e("th",{scope:"col"},"折扣百分比"),e("th",{scope:"col"},"到期日"),e("th",{scope:"col"},"是否啟用"),e("th",{scope:"col"},"編輯")])],-1),me={key:0,class:"text-success"},he={key:1,class:"text-danger"},be=["onClick"],fe=["onClick"];function Ce(t,o,d,b,s,a){const n=C("Coupon-Modal"),M=C("Del-Coupon-Modal");return i(),c($,null,[ae,e("div",ie,[e("div",ce,[e("button",{type:"button",class:"btn btn-secondary",onClick:o[0]||(o[0]=l=>a.openModal("new"))},"新增優惠券")]),e("div",pe,[e("div",ue,[e("table",re,[_e,e("tbody",null,[(i(!0),c($,null,y(s.coupons,l=>(i(),c("tr",{key:l.id},[e("td",null,p(l.title),1),e("td",null,p(l.code),1),e("td",null,p(l.percent)+"%",1),e("td",null,p(new Date(l.due_date*1e3).toLocaleDateString()),1),e("td",null,[l.is_enabled?(i(),c("span",me,"啟用")):(i(),c("span",he,"未啟用"))]),e("td",null,[e("button",{class:"btn btn-sm btn-outline-secondary me-1",onClick:w=>a.openModal("edit",l)}," 編輯 ",8,be),e("button",{class:"btn btn-sm btn-outline-danger",onClick:w=>a.openModal("delete",l)}," 刪除 ",8,fe)])]))),128))])])])])]),v(n,{ref:"couponModal",coupon:s.tempCoupon,onUpdateCoupon:a.updateCoupon,isNew:s.isNew},null,8,["coupon","onUpdateCoupon","isNew"]),v(M,{ref:"delModal",coupon:s.tempCoupon,onDeleteCoupon:a.deleteCoupon},null,8,["coupon","onDeleteCoupon"])],64)}const ge=h(de,[["render",Ce]]);export{ge as default};
