import{_ as M,o as i,c as n,b as t,g as _,L as m,t as p,F as y,f as k,N as D,d as w,H as f,r as g,h as v}from"./index-AegjoZ9k.js";import{A as h}from"./swal-KTZD3iGR.js";import{P as V}from"./PaginationComponent--GHUHv3y.js";import{m as P}from"./modalMixin-WbUaZb-0.js";import"./sweetalert2.all-1u5CGTXs.js";const C={props:["tempArticle","updateArticle","isNew"],data(){return{modalArticle:null,editArticle:{},create_at:""}},mixins:[P],methods:{createArticles(){this.editArticle.tag=[],this.editArticle.tag.push("")}},mounted(){},watch:{tempArticle(){this.editArticle=this.tempArticle,[this.create_at]=new Date(this.editArticle.create_at*1e3).toISOString().split("T")},create_at(){this.editArticle.create_at=Math.floor(new Date(this.create_at)/1e3)}}},U={id:"articleModal",ref:"modal",class:"modal fade",tabindex:"-1"},T={class:"modal-dialog modal-xl"},I={class:"modal-content border-0"},N={class:"modal-header bg-dark text-white"},E={id:"articleModalLabel",class:"modal-title"},S={key:0},L={key:1},R=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"},null,-1),B={class:"modal-body"},H={class:"row"},O={class:"col-sm-4"},F={class:"mb-3"},J=t("label",{for:"imageUrl",class:"form-label"},"圖片",-1),j=["src"],z={class:"col-sm-8"},K={class:"row"},W={class:"col-6 mb-3"},Y=t("label",{for:"title",class:"form-label"},"文章標題",-1),q={class:"col-6 mb-3"},G=t("label",{for:"content",class:"form-label"},"文章概要",-1),Q={class:"row"},X={class:"mb-3 col-md-6"},Z=t("label",{for:"create_at",class:"form-label"},"建立時間",-1),tt={class:"mb-3 col-md-6"},et=t("label",{for:"author",class:"form-label"},"作者",-1),st=t("hr",null,null,-1),lt=t("h6",{class:"mb-3"},"文章標籤",-1),ot={key:0},it={class:"mb-3"},nt=["for"],ct=["id","onUpdate:modelValue"],at={key:0},dt={key:1},rt={key:1},_t=t("hr",null,null,-1),mt={class:"mb-3 col-md-12"},pt=t("label",{for:"description",class:"form-label"},"文章內容",-1),ht={class:"mb-3"},ut={class:"form-check"},bt=t("label",{class:"form-check-label",for:"isPublic"},"是否公開",-1),At={class:"modal-footer"},ft=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function gt(o,e,c,x,s,a){return i(),n("div",U,[t("div",T,[t("div",I,[t("div",N,[t("h5",E,[c.isNew?(i(),n("span",S,"新增文章")):(i(),n("span",L,"編輯文章"))]),R]),t("div",B,[t("div",H,[t("div",O,[t("div",F,[J,_(t("input",{id:"imageUrl","onUpdate:modelValue":e[0]||(e[0]=l=>s.editArticle.image=l),type:"text",class:"form-control mb-2",placeholder:"請輸入圖片連結"},null,512),[[m,s.editArticle.image]]),t("img",{class:"img-fluid",src:s.editArticle.image},null,8,j)])]),t("div",z,[t("pre",null,"                "+p(s.editArticle)+`
              `,1),t("div",K,[t("div",W,[Y,_(t("input",{id:"title","onUpdate:modelValue":e[1]||(e[1]=l=>s.editArticle.title=l),type:"text",class:"form-control",placeholder:"請輸入文章標題"},null,512),[[m,s.editArticle.title]])]),t("div",q,[G,_(t("input",{id:"content",value:"蔬食","onUpdate:modelValue":e[2]||(e[2]=l=>s.editArticle.content=l),type:"text",class:"form-control",placeholder:"請輸入文章概要"},null,512),[[m,s.editArticle.content]])])]),t("div",Q,[t("div",X,[Z,_(t("input",{id:"create_at","onUpdate:modelValue":e[3]||(e[3]=l=>s.create_at=l),type:"date",class:"form-control"},null,512),[[m,s.create_at]])]),t("div",tt,[et,_(t("input",{id:"author","onUpdate:modelValue":e[4]||(e[4]=l=>s.editArticle.author=l),type:"text",class:"form-control",placeholder:"請輸入作者"},null,512),[[m,s.editArticle.author]])])]),st,lt,Array.isArray(s.editArticle.tag)?(i(),n("div",ot,[(i(!0),n(y,null,k(s.editArticle.tag,(l,d)=>(i(),n("div",{class:"mb-1",key:d},[t("div",it,[t("label",{for:l+d,class:"form-label"},p(`標籤 ${d+1}`),9,nt),_(t("input",{id:l+d,"onUpdate:modelValue":A=>s.editArticle.tag[d]=A,type:"text",class:"form-control w-25",placeholder:"請輸入標籤名稱"},null,8,ct),[[m,s.editArticle.tag[d]]])])]))),128)),!s.editArticle.tag.length||s.editArticle.tag[s.editArticle.tag.length-1]?(i(),n("div",at,[t("button",{class:"btn btn-outline-secondary btn-sm d-block",onClick:e[5]||(e[5]=l=>s.editArticle.tag.push(""))}," 新增標籤 ")])):(i(),n("div",dt,[t("button",{class:"btn btn-outline-danger btn-sm d-block",onClick:e[6]||(e[6]=l=>s.editArticle.tag.pop())}," 刪除標籤 ")]))])):(i(),n("div",rt,[t("button",{class:"btn btn-outline-secondary btn-sm d-block",onClick:e[7]||(e[7]=(...l)=>a.createArticles&&a.createArticles(...l))}," 新增標籤 ")])),_t,t("div",mt,[pt,_(t("textarea",{id:"description","onUpdate:modelValue":e[8]||(e[8]=l=>s.editArticle.description=l),type:"text",class:"form-control",placeholder:"請輸入文章內容",rows:"10"},null,512),[[m,s.editArticle.description]])]),t("div",ht,[t("div",ut,[_(t("input",{id:"isPublic","onUpdate:modelValue":e[9]||(e[9]=l=>s.editArticle.isPublic=l),class:"form-check-input",type:"checkbox"},null,512),[[D,s.editArticle.isPublic]]),bt])])])])]),t("div",At,[ft,t("button",{type:"button",class:"btn btn-secondary",onClick:e[10]||(e[10]=l=>o.$emit("updateArticle",s.editArticle))}," 確認 ")])])])],512)}const vt=M(C,[["render",gt]]),yt={props:["tempArticle","delArticle"],data(){return{delModalArticle:null}},mixins:[P]},Mt={id:"delArticleModal",ref:"modal",class:"modal fade",tabindex:"-1"},xt={class:"modal-dialog"},wt={class:"modal-content border-0"},kt=t("div",{class:"modal-header bg-danger text-white"},[t("h5",{id:"delArticleModalLabel",class:"modal-title"},[t("span",null,"刪除產品")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1),Pt={class:"modal-body"},$t={class:"text-danger"},Dt={class:"modal-footer"},Vt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Ct(o,e,c,x,s,a){return i(),n("div",Mt,[t("div",xt,[t("div",wt,[kt,t("div",Pt,[w(" 是否刪除 "),t("strong",$t,p(c.tempArticle.title),1),w(" 文章(刪除後將無法恢復)。 ")]),t("div",Dt,[Vt,t("button",{type:"button",class:"btn btn-danger",onClick:e[0]||(e[0]=l=>o.$emit("delArticle"))}," 確認刪除 ")])])])],512)}const Ut=M(yt,[["render",Ct]]);var Tt={VITE_API_URL:"https://ec-course-api.hexschool.io/v2",VITE_API_PATH:"js23",VITE_MAP_KEY:"AIzaSyBLmNf-TuB_bpae0roR3SSEJy40ssJR5eI",BASE_URL:"/HW-Vue-week6/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API_URL:u,VITE_API_PATH:b}=Tt,It={data(){return{articles:[],tempArticle:{tag:[]},pages:{},modalProduct:null,delModalProduct:null,isNew:!1}},components:{PaginationComponent:V,ArticleModal:vt,DelArticleModal:Ut},mounted(){this.getData()},methods:{getData(o=1){const e=`${u}/api/${b}/admin/articles?page=${o}`;f.get(e).then(c=>{console.log(c),this.articles=c.data.articles,this.pages=c.data.pagination}).catch(c=>{alert(c.response.data.message)})},updateArticle(){let o=`${u}/api/${b}/admin/article`,e="post";this.isNew||(o=`${u}/api/${b}/admin/article/${this.tempArticle.id}`,e="put"),f[e](o,{data:this.tempArticle}).then(c=>{h.toastTop(c.data.message,"success"),this.getData(),this.$refs.articleModal.closeModal()}).catch(c=>{h.toastTop(c.response.data.message,"error")})},openModal(o,e){o==="new"?(this.tempArticle={tag:[],create_at:Math.floor(new Date().getTime()/1e3),isPublic:!0,content:"蔬食"},this.isNew=!0,this.$refs.articleModal.openModal()):o==="edit"?(this.tempArticle={...e},this.tempArticle.image||(this.tempArticle.image=[]),this.isNew=!1,this.$refs.articleModal.openModal()):o==="delete"&&(this.tempArticle={...e},this.$refs.delModal.openModal())},delArticle(){const o=`${u}/api/${b}/admin/article/${this.tempArticle.id}`;f.delete(o).then(e=>{h.toastTop(e.data.message,"success"),this.$refs.delModal.closeModal(),this.getData()}).catch(e=>{h.toastTop(e.response.data.message,"error")})}}},Nt=t("h2",{class:"mt-2"},"文章管理",-1),Et={class:"container"},St={class:"text-end mt-4"},Lt={class:"table mt-4"},Rt=t("thead",null,[t("tr",null,[t("th",{width:"90"},"作者"),t("th",{width:"120"},"文章標題"),t("th",{width:"120",class:"text-end"},"建立時間"),t("th",{width:"120",class:"text-center"},"是否公開"),t("th",{width:"120",class:"text-center"},"編輯")])],-1),Bt={class:"text-end"},Ht={class:"text-center"},Ot={key:0,class:"text-success"},Ft={key:1},Jt={class:"text-center"},jt={class:"btn-group"},zt=["onClick"],Kt=["onClick"];function Wt(o,e,c,x,s,a){const l=g("Pagination-Component"),d=g("Article-Modal"),A=g("Del-Article-Modal");return i(),n(y,null,[Nt,t("div",Et,[t("div",St,[t("button",{class:"btn btn-secondary",onClick:e[0]||(e[0]=r=>a.openModal("new"))},"建立新文章")]),t("table",Lt,[Rt,t("tbody",null,[(i(!0),n(y,null,k(s.articles,r=>(i(),n("tr",{key:r.id},[t("td",null,p(r.author),1),t("td",null,p(r.title),1),t("td",Bt,p(new Date(r.create_at*1e3).toLocaleDateString()),1),t("td",Ht,[r.isPublic?(i(),n("span",Ot,"公開")):(i(),n("span",Ft,"未公開"))]),t("td",Jt,[t("div",jt,[t("button",{type:"button",class:"btn btn-outline-secondary btn-sm",onClick:$=>a.openModal("edit",r)}," 編輯 ",8,zt),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:$=>a.openModal("delete",r)}," 刪除 ",8,Kt)])])]))),128))])]),v(l,{pages:s.pages,onChangePage:a.getData},null,8,["pages","onChangePage"])]),v(d,{"temp-article":s.tempArticle,"is-new":s.isNew,onUpdateArticle:a.updateArticle,ref:"articleModal"},null,8,["temp-article","is-new","onUpdateArticle"]),v(A,{"temp-article":s.tempArticle,onDelArticle:a.delArticle,ref:"delModal"},null,8,["temp-article","onDelArticle"])],64)}const Zt=M(It,[["render",Wt]]);export{Zt as default};
